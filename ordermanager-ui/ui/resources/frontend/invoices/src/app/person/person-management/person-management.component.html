<div *ngIf="appSecurityService.isAuthenticated();" class="p-fluid">
    <H2>Person management</H2>
    <div>
      <p-toast></p-toast>
    </div>

  <div class="p-col-12">
    <app-dateperiod-finder [url]="'person/personsListPeriod'" (responseOutput)="persons = $event" #dataFinder/>

    <p-table [value]="persons" [rows]="10"
             paginator = "true"
             [autoLayout]="true"
             selectionMode="multiple"
             [metaKeySelection] = keySelection
             [(selection)] = "selectedPerson"
             [resizableColumns]="true" styleClass="p-datatable-gridlines" editMode="row">
      <ng-template pTemplate="header">
        <tr>
          <th style="width: 20%">Person last name</th>
          <th style="width: 15%">Person first name</th>
          <th style="width: 25%">Company name</th>
          <th style="width: 10%">Person type</th>
          <th style="width: 10%">Tax number</th>
          <th style="width: 20%">E-mail</th>
          <th style="width: 5%">Manage</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-person let-rowIndex="rowIndex">
        <tr  [ngStyle]= "{'color':isPersonChanged(person)}"  title="Double click to edit person"
            [pSelectableRow]="person"
            [pSelectableRowIndex]="rowIndex"
            (dblclick)="rowDoubleClick($event, person)" >
          <td>
            <div>{{person.personLastName}}</div>
          </td>
          <td>
            <div>{{person.personFirstName}}</div>
          </td>
          <td>
            <div>{{person.companyName}}</div>
          </td>
          <td>
            <div>{{person.personType}}</div>
          </td>
          <td>
            <div>{{person.taxNumber}}</div>
          </td>
          <td>
            <div>{{person.email}}</div>
          </td>
          <td>
            <button pButton pRipple icon="pi pi-trash" class="p-button-rounded p-button-warning"
                    (click)="deletePerson(person.id)"></button>
            <button  style = "margin-left: 2px;" pButton pRipple icon="pi pi-pencil" class="p-button-rounded p-button-warning"
                    (click)="rowDoubleClick($event, person)"></button>
          </td>
        </tr>

      </ng-template>
    </p-table>
  </div>
  </div>
 <div class="p-grid">
   <div class ="p-col-11 ">
   </div>
   <div class ="p-col-1 ">
     <p-button class="saveButton-align" [disabled]="haveNoChanges()" label="Save" (onClick)="saveChangedPersons($event)"></p-button>
   </div>
 </div>

<app-edit-person-dialog [visible] = "showPersonDialog()"
                        (visibilityChanged) = "isPersonEditDialogVisible($event)"
                        (personModelChanges) = "putPersonChanges($event)"
                        #personDialog>
</app-edit-person-dialog>

<app-confirmation-dialog [display]="showConfirmDialog"
                         [message]="confirmDialogMessage"
                         (confirmed)="handleConfirmation(confirmDialog.transferObject)"
                         (canceled) = "handleCancel($event)"
                         #confirmDialog></app-confirmation-dialog>

