@if (isAuthenticated()) {
<div class="p-fluid">
  <p-toast></p-toast>
  <div class="p-grid p-col-6">
    <H2>Create Person</H2>
  </div>
  <form #personForm="ngForm">
    <div class=" p-shadow-4">
      <div class="p-grid item-left">
        <div class="p-col-6 ">
          <app-validatable-dropdownlist (componentHasError)="setHasPersonTypeError($event)"
                                        (valueChanged)="peronTypeChanged($event)"
                                        [(ngModel)]="personFormModel.personType"
                                        [idComponent]="'id-personType'"
                                        [labelText]="'Person Type'"
                                        [optionList]="personType"
                                        [txtMinLength]="1"
                                        inputName="personType"
                                        name="personType">
          </app-validatable-dropdownlist>
        </div>
      </div>

      <div *ngIf="personFormModel.personType==='PRIVATE'" class="p-grid item-left">
        <div class="p-col-3">
          <app-validatable-input-text (componentHasErrorEvent)="setHasFirstNameError($event)"
                                      [(ngModel)]="personFormModel.personFirstName"
                                      [idComponent]="'id_firstName'"
                                      [labelText]="'First name'"
                                      [txtMinLength]="2"
                                      inputName="personFirstName"
                                      name="personFirstName">
          </app-validatable-input-text>
        </div>
        <div class="p-col-3">
          <app-validatable-input-text (componentHasErrorEvent)="setHasLastNameError($event)"
                                      [(ngModel)]="personFormModel.personLastName"
                                      [idComponent]="'id_lastName'"
                                      [labelText]="'Last name'"
                                      [txtMinLength]="2"
                                      inputName="personLastName"
                                      name="personLastName">
          </app-validatable-input-text>
        </div>
      </div>

      <div *ngIf="personFormModel.personType==='ORGANISATION'" class="p-grid item-left">
        <div class="p-col-3">
          <app-validatable-input-text (componentHasErrorEvent)="setHasCompanyNameError($event)"
                                      [(ngModel)]="personFormModel.companyName"
                                      [idComponent]="'id_company_Name'"
                                      [labelText]="'Company name'"
                                      [txtMinLength]="2"
                                      inputName="companyName"
                                      name="companyName">
          </app-validatable-input-text>
        </div>
      </div>
      <div class="p-grid item-left">
        <div class="p-col-3">
          <app-validatable-input-text (componentHasErrorEvent)="setHasEmailError($event)"
                                      [(ngModel)]="personFormModel.email"
                                      [idComponent]="'id_email'"
                                      [inputPattern]="emailPattern"
                                      [inputType]="'text'"
                                      [labelText]="'E-mail'"
                                      [txtMinLength]="5"
                                      name="email"
                                      patternErrorText="Wrong email">
          </app-validatable-input-text>
        </div>
      </div>

        <div *ngIf="personFormModel.personType==='PRIVATE'" class="p-col-2  item-left">
          <app-validatable-input-text (componentHasErrorEvent)="setHasTaxNumberError($event)"
                                      [(ngModel)]="personFormModel.taxNumber"
                                      [idComponent]="'id_tax_Number'"
                                      [labelText]="'Tax number'"
                                      [txtMinLength]="5"
                                      inputName="taxNumber"
                                      name="taxNumber">
          </app-validatable-input-text>
        </div>
    </div>
    <div class="p-grid p-col-6">
      <H2>Person address</H2>
    </div>
    <div class=" p-shadow-4">

      <div class="p-grid item-left">
        <div class="p-col-2 zip-container">
          <app-validatable-input-text (componentHasErrorEvent)="setHasZipCodeError($event)"
                                      [(ngModel)]="personFormModel.personAddressFormModel.zipCode"
                                      [idComponent]="'id_Zip'"
                                      [labelText]="'Zip'"
                                      [txtMinLength]="4"
                                      inputName="zipCode"
                                      name="zipCode">
          </app-validatable-input-text>
        </div>
        <div class="p-col-3 city-container">
          <app-validatable-input-text (componentHasErrorEvent)="setHasCityError($event)"
                                      [(ngModel)]="personFormModel.personAddressFormModel.city"
                                      [idComponent]="'id_City'"
                                      [labelText]="'City'"
                                      [txtMinLength]="2"
                                      inputName="city"
                                      name="city">
          </app-validatable-input-text>
        </div>
      </div>
      <div class="p-grid item-left">
        <div class="p-col-2">
          <span class="p-float-label">
            <input [(ngModel)]="personFormModel.personAddressFormModel.postBoxCode" id="id-add-postBoxCode"
                   name="postBoxCode" pInputText
                   style="margin-left: 0px !Important"
                   type="text"/>
            <label for="id-add-postBoxCode">Post Box</label>
          </span>
        </div>
        <div class="p-col-3 street-container">

            <app-validatable-input-text (componentHasErrorEvent)="setHasStreetError($event)"
                                        [(ngModel)]="personFormModel.personAddressFormModel.street"
                                        [idComponent]="'id_Street'"
                                        [labelText]="'Street'"
                                        [txtMinLength]="2"
                                        inputName="street"
                                        name="street">
            </app-validatable-input-text>
        </div>

      </div>
    </div>
    <div class="p-grid">
      <div class="p-col-6">
        <H2>Person bank account</H2>
      </div>
    </div>
    <div class=" p-shadow-4">
      <div class="p-grid item-left">
        <div class="p-col-4 bank-name-container">
          <app-validatable-input-text (componentHasErrorEvent)="setHasBankNameError($event)"
                                      [(ngModel)]="personFormModel.bankAccountFormModel.bankName"
                                      [idComponent]="'id_BankName'"
                                      [labelText]="'Bank name'"
                                      [txtMinLength]="2"
                                      inputName="bankName"
                                      name="bankName">
          </app-validatable-input-text>
        </div>

        <div class="p-col-2">
          <span class="p-float-label">
            <input [(ngModel)]="personFormModel.bankAccountFormModel.accountNumber" id="id_AccountNumber"
                   name="accountNumber"
                   pInputText
                   type="text"/>
            <label for="id_AccountNumber">Account number</label>
          </span>
        </div>
      </div>

      <div class="p-grid item-left">
        <div class="p-col-4 iban-container">
          <div class = "full-width-display-table">
            <div class = "full-width-display-row">
              <div class = "full-width-display-cell">
               <span class="p-float-label">
                    <input #modelRef="ngModel"
                           (ngModelChange)="personFormModel.bankAccountFormModel.iban = $event"
                           [ngModel]="personFormModel.bankAccountFormModel.iban | ibanFormatter"
                           class="ng-dirty p-mr-2"
                           ibanValidator
                           id="id_IBAN"
                           name="iban"
                           pInputText
                           required
                           type="text"/>
                  <label for="id_IBAN">IBAN</label>
               </span>
              </div>
              <div class = "error-message-cmp" *ngIf="modelRef.errors?.required" id="id_Iban_Required_err">
                <p-message severity="error"></p-message>
              </div>
              <div class = "error-message-cmp" *ngIf="setHasIbahError(modelRef.errors?.iban!==null, modelRef.errors?.iban)" id="id_Iban_Iban_err">
                <p-message severity="error"></p-message>
              </div>
              <ng-template *ngIf="modelRef?.valid">
                <ng-template *ngIf="setHasIbahError(false, modelRef.errors?.iban)"/>
              </ng-template>
            </div>
            <div *ngIf="modelRef.errors?.iban" class="alert alert-danger">
              Wrong IBAN
            </div>
          </div>
        </div>

        <div class="p-col-2 swift-style">
          <app-validatable-input-text (componentHasErrorEvent)="setHasBicError($event)"
                                      [(ngModel)]="personFormModel.bankAccountFormModel.bicSwift"
                                      [idComponent]="'id-acc-bicSwift'"
                                      [labelText]="'BIC/SWIFT'"
                                      [txtMinLength]="5"
                                      inputName="bicSwift"
                                      name="bicSwift">
          </app-validatable-input-text>
        </div>
      </div>
    </div>
    <div class="p-grid buttons-container">
      <div class="p-col-12 save-button-col-size">
        <div *ngIf=" createPersonType === undefined; else elseBlock">
          <p-button (onClick)="savePerson(false)" [disabled]="haveErrors()"
                    class="save-button-col-size save-button-container-size"
                    label="Save"></p-button>
        </div>
        <ng-template #elseBlock>
          <p-button (onClick)="savePerson(true)" [disabled]="haveErrors()"
                    class="save-button-col-size save-button-container-size" label="Save and return"></p-button>
        </ng-template>
      </div>
    </div>
  </form>
</div>
}


